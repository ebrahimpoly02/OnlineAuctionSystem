{% extends 'auctions/base.html' %}
{% load static %}

{% block title %}Home - Bidfinity{% endblock %}

{% block content %}
<h1 style="font-size: 2rem; margin-bottom: 1rem;">Featured Auctions</h1>

{% if auctions %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
    {% for auction in auctions %}
    <div class="card">
        <!-- Auction Image -->
        <div style="width: 100%; height: 200px; background-color: #e0e0e0; border-radius: 8px; margin-bottom: 1rem; overflow: hidden;">
            {% if auction.images.exists %}
                {% with auction.images.first as primary_image %}
                <img src="{{ primary_image.image.url }}" alt="{{ auction.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% endwith %}
            {% endif %}
        </div>
        
        <!-- Auction Info -->
        <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem;">{{ auction.title }}</h3>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">
            {{ auction.description|truncatewords:10 }}
        </p>
        <p style="font-weight: bold; font-size: 1.1rem; color: #1a2332; margin: 0.5rem 0;">
            Current Bid: {{ auction.current_price }} BHD
        </p>
        <p style="color: #666; font-size: 0.9rem;">
            Ends in: <span class="time-remaining" data-end-time="{{ auction.end_time|date:'c' }}">
                {{ auction.time_remaining }}
            </span>
        </p>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
            Number of bids: {{ auction.bid_count }}
        </p>
        <p style="color: #888; font-size: 0.85rem;">
            Seller: {{ auction.seller.username }}
        </p>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="color: #666; margin-top: 2rem;">No active auctions at the moment.</p>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
function updateTimers() {
    const timers = document.querySelectorAll('.time-remaining');
    
    timers.forEach(timer => {
        const endTime = new Date(timer.getAttribute('data-end-time'));
        const now = new Date();
        const diff = endTime - now;
        
        if (diff <= 0) {
            timer.textContent = 'Ended';
            timer.style.color = '#999';
            return;
        }
        
        // Calculate time
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        // Format display
        let timeString = '';
        if (days > 0) {
            timeString = `${days} days ${hours} hours`;
        } else if (hours > 0) {
            timeString = `${hours} hours ${minutes} minutes`;
        } else {
            timeString = `${minutes} minutes ${seconds} seconds`;
            // Make it red if less than 1 hour
            timer.style.color = '#dc3545';
            timer.style.fontWeight = 'bold';
        }
        
        timer.textContent = timeString;
    });
}

// Update immediately
updateTimers();

// Update every second
setInterval(updateTimers, 1000);
</script>
{% endblock %}