{% extends 'auctions/base.html' %}
{% load static %}

{% block title %}Rate Seller - Bidfinity{% endblock %}

{% block content %}
<style>
    .rating-container {
        max-width: 600px;
        margin: 2rem auto;
        background: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .rating-container h1 {
        font-size: 2rem;
        margin-bottom: 1.5rem;
        color: #1a2332;
    }
    
    .auction-info {
        background: #f9f9f9;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    
    .auction-info h3 {
        margin: 0 0 0.5rem 0;
        color: #1a2332;
    }
    
    .auction-info p {
        margin: 0.25rem 0;
        color: #666;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #666;
        font-weight: 600;
    }
    
    .star-rating {
        display: flex;
        gap: 0.5rem;
        font-size: 2rem;
    }
    
    .star {
        cursor: pointer;
        color: #ddd;
        transition: color 0.2s;
    }
    
    .star:hover,
    .star.active {
        color: #FFA500;
    }
    
    textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        font-family: inherit;
        min-height: 120px;
        resize: vertical;
    }
    
    textarea:focus {
        outline: none;
        border-color: #1a2332;
    }
    
    .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .btn-submit {
        flex: 1;
        padding: 1rem;
        background-color: #FFA500;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
    }
    
    .btn-submit:hover {
        background-color: #FF8C00;
    }
    
    .btn-submit:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
    
    .btn-cancel {
        flex: 1;
        padding: 1rem;
        background-color: white;
        color: #1a2332;
        border: 2px solid #1a2332;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .btn-cancel:hover {
        background-color: #1a2332;
        color: white;
    }
    
    .required {
        color: red;
    }
</style>

<div class="rating-container">
    <h1>Rate Seller</h1>
    
    <div class="auction-info">
        <h3>{{ auction.title }}</h3>
        <p><strong>Seller:</strong> {{ seller.username }}</p>
        <p><strong>Amount Paid:</strong> {{ payment.amount }} BHD</p>
        <p><strong>Date:</strong> {{ payment.transaction_date|date:"M d, Y" }}</p>
    </div>
    
    <form method="post" id="ratingForm">
        {% csrf_token %}
        
        <div class="form-group">
            <label>Rating <span class="required">*</span></label>
            <div class="star-rating" id="starRating">
                <span class="star" data-rating="1">★</span>
                <span class="star" data-rating="2">★</span>
                <span class="star" data-rating="3">★</span>
                <span class="star" data-rating="4">★</span>
                <span class="star" data-rating="5">★</span>
            </div>
            <input type="hidden" name="rating_score" id="ratingScore" required>
            <p style="color: #999; font-size: 0.875rem; margin-top: 0.5rem;">Click to rate from 1 (poor) to 5 (excellent)</p>
        </div>
        
        <div class="form-group">
            <label for="comment">Comment (optional)</label>
            <textarea id="comment" name="comment" placeholder="Share your experience with this seller..."></textarea>
        </div>
        
        <div class="button-group">
            <a href="{% url 'account' %}" class="btn-cancel">Cancel</a>
            <button type="submit" class="btn-submit" id="submitBtn" disabled>Submit Rating</button>
        </div>
    </form>
</div>

<script>
    const stars = document.querySelectorAll('.star');
    const ratingScore = document.getElementById('ratingScore');
    const submitBtn = document.getElementById('submitBtn');
    let selectedRating = 0;
    
    stars.forEach(star => {
        star.addEventListener('click', function() {
            selectedRating = parseInt(this.dataset.rating);
            ratingScore.value = selectedRating;
            submitBtn.disabled = false;
            
            // Update star display
            stars.forEach((s, index) => {
                if (index < selectedRating) {
                    s.classList.add('active');
                } else {
                    s.classList.remove('active');
                }
            });
        });
        
        // Hover effect
        star.addEventListener('mouseenter', function() {
            const hoverRating = parseInt(this.dataset.rating);
            stars.forEach((s, index) => {
                if (index < hoverRating) {
                    s.style.color = '#FFA500';
                } else {
                    s.style.color = '#ddd';
                }
            });
        });
    });
    
    // Reset hover effect
    document.getElementById('starRating').addEventListener('mouseleave', function() {
        stars.forEach((s, index) => {
            if (index < selectedRating) {
                s.style.color = '#FFA500';
            } else {
                s.style.color = '#ddd';
            }
        });
    });
</script>
{% endblock %}